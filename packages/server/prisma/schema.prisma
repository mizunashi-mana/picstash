// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "sqlite"
}

model Image {
  id            String           @id @default(uuid())
  filename      String
  path          String
  thumbnailPath String?          @map("thumbnail_path")
  mimeType      String           @map("mime_type")
  size          Int
  width         Int?
  height        Int?
  description   String?
  embedding     Bytes?           /// CLIP embedding vector (512 dimensions, Float32Array)
  embeddedAt    DateTime?        @map("embedded_at") /// When embedding was generated
  createdAt     DateTime         @default(now()) @map("created_at")
  updatedAt     DateTime         @updatedAt @map("updated_at")
  attributes    ImageAttribute[]
}

model AttributeLabel {
  id         String           @id @default(uuid())
  name       String           @unique
  color      String?
  embedding  Bytes?           /// CLIP text embedding vector (512 dimensions, Float32Array)
  embeddedAt DateTime?        @map("embedded_at") /// When embedding was generated
  createdAt  DateTime         @default(now()) @map("created_at")
  updatedAt  DateTime         @updatedAt @map("updated_at")
  attributes ImageAttribute[]
}

model ImageAttribute {
  id        String         @id @default(uuid())
  imageId   String         @map("image_id")
  labelId   String         @map("label_id")
  keywords  String?
  image     Image          @relation(fields: [imageId], references: [id], onDelete: Cascade)
  label     AttributeLabel @relation(fields: [labelId], references: [id], onDelete: Cascade)
  createdAt DateTime       @default(now()) @map("created_at")
  updatedAt DateTime       @updatedAt @map("updated_at")

  @@unique([imageId, labelId])
  @@map("image_attribute")
}

model Collection {
  id           String            @id @default(uuid())
  name         String
  description  String?
  coverImageId String?           @map("cover_image_id")
  createdAt    DateTime          @default(now()) @map("created_at")
  updatedAt    DateTime          @updatedAt @map("updated_at")
  images       CollectionImage[]
}

model CollectionImage {
  id           String     @id @default(uuid())
  collectionId String     @map("collection_id")
  imageId      String     @map("image_id")
  order        Int        @default(0)
  collection   Collection @relation(fields: [collectionId], references: [id], onDelete: Cascade)
  createdAt    DateTime   @default(now()) @map("created_at")

  @@unique([collectionId, imageId])
  @@map("collection_image")
}
