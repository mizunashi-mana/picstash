# Picstash プロダクト概要

## 目的

Picstash は、イラストや画像作品を効率的に整理・管理するためのアプリケーションです。AI による自動属性付けや説明生成、類似画像検出により、**手作業をほとんど必要とせず**大量の画像コレクションを管理できます。

## ターゲット

- 個人利用（シングルユーザー、ログイン不要）
- 中規模コレクション（数万枚程度）
- マルチプラットフォーム（Web → ネイティブアプリへ段階的に拡張）

## コア機能

### 1. 画像管理
- Web UI からのドラッグ＆ドロップでアップロード
- サムネイル付きギャラリー表示
- 画像の詳細表示・フルスクリーン表示
- 画像の削除

### 2. アーカイブインポート
- **対応形式**: ZIP、RAR、7z などの一般的なアーカイブ形式
- **プレビュー機能**: アーカイブ内の画像一覧をサムネイル付きでプレビュー表示
- **選択的インポート**:
  - チェックボックスで取り込む画像を個別に選択/解除
  - 全選択/全解除ボタン
  - ファイル名やサイズでのフィルタリング
- **一括インポート**: 選択した画像をまとめてライブラリに追加
- **フォルダ構造の維持**: アーカイブ内のフォルダ構造をコレクションとして再現可能（オプション）
- **重複チェック**: インポート前に既存画像との重複を検出して警告

### 3. 属性管理
- **属性ラベル**: 画像に付与できる分類軸（例：作者、登場人物、関連キーワードなど）
- **複数キーワード**: 各属性ラベルに対して複数のキーワードを設定可能
- 属性ラベルはユーザーが自由に作成・編集・削除
- 従来の「タグ」は「関連キーワード」属性として表現可能

#### 属性の例
| 属性ラベル | キーワード例 |
|-----------|-------------|
| 作者 | 山田太郎, pixiv:12345 |
| 登場人物 | キャラA, キャラB |
| 関連キーワード | 風景, 夕焼け, ファンタジー |
| シリーズ | ○○物語 |
| 作成日 | 2024-01 |

### 4. 画像説明
- 各画像に自由形式の説明文（キャプション）を付与
- 画像の内容、背景、感想などを記録
- 詳細画面で属性とともに俯瞰可能
- 検索対象にも含まれる

### 5. AI 自動付与
- ローカル AI モデル（CLIP 等）による画像解析
- アップロード時に自動で属性・説明を推薦・付与
- キャラクター、背景、色調、構図などを自動認識
- 必要に応じて手動で編集も可能

### 6. 類似画像検出
- **重複検出**: 同一または微修正版の画像を検出して整理
- **スタイル類似**: 画風や色調が似た作品を自動グルーピング
- 類似画像の一覧表示

### 7. 検索機能
- 属性による絞り込み検索（例：作者=山田太郎）
- キーワード検索（属性値・説明文を横断検索）
- 複数条件での検索（AND/OR）

### 8. コレクション機能
- シリーズもの（ストーリー、漫画など）の画像をまとめて管理
- 手動でコレクションを作成・編集・削除
- 作品をコレクションに追加・削除・並び替え
- コレクション単位での連続閲覧（ページ送り）

### 9. 閲覧履歴・推薦機能
- **閲覧履歴の記録**: どの画像をいつ、どのくらい見たかを自動記録
  - 閲覧日時
  - 滞在時間（詳細画面での閲覧時間）
  - 閲覧回数
- **パーソナライズ推薦**: 閲覧傾向と画像ベクトルを組み合わせて推薦
  - 「今日のおすすめ」: その日の気分に合った画像を提案
  - よく見る画像に類似した作品を発見
  - 最近見ていない好みの画像をリマインド
- **コンバージョン記録・フィードバック**: 推薦の精度向上に活用
  - 推薦画像のクリック有無
  - 推薦経由の閲覧時間（興味度の指標）
  - スキップされた推薦の記録
  - フィードバックループによる推薦モデルの継続的改善
- **統計ダッシュボード**:
  - 閲覧傾向の可視化（時間帯、曜日、期間）
  - よく見る属性・作者の分析
  - コレクション別の閲覧統計
  - 推薦精度の推移（コンバージョン率など）

### 10. 動画対応
- **対応形式**: MP4、WebM、GIF アニメーションなど一般的な動画形式
- **サムネイル生成**: 動画の代表フレームからサムネイルを自動生成
- **インライン再生**: ギャラリー上でホバー時にプレビュー再生（オプション）
- **詳細画面での再生**:
  - 再生/一時停止、シークバー、音量調整
  - ループ再生オプション
  - 全画面表示
- **動画メタデータ**: 再生時間、解像度、フレームレートなどを自動取得
- **AI 解析対応**: 動画からキーフレームを抽出して属性・説明を推薦
- **画像との統合管理**: 動画も画像と同じギャラリー・検索・コレクションで管理

## ユースケース

### UC-1: イラストのアップロード
1. ユーザーが画像をドラッグ＆ドロップでアップロード
2. AI が自動で画像を解析し属性・説明を付与
3. ユーザーは必要に応じて属性・説明を確認・修正
4. ギャラリーに追加される

### UC-2: アーカイブからのインポート
1. ユーザーが ZIP/RAR/7z ファイルをドロップまたは選択
2. アーカイブ内の画像一覧がサムネイル付きでプレビュー表示される
3. ユーザーがインポートしたい画像をチェックボックスで選択（フィルタ機能で絞り込み可能）
4. 「インポート」ボタンで選択した画像をライブラリに追加
5. オプションでフォルダ構造をコレクションとして保持
6. 既存画像との重複がある場合は警告を表示

### UC-3: 画像情報の閲覧・編集
1. ユーザーが画像の詳細画面を開く
2. 属性（ラベル+キーワード）と説明文が一覧表示される
3. 属性の追加・編集、説明文の編集が可能
4. 保存して完了

### UC-4: 属性ラベルの管理
1. ユーザーが設定画面で属性ラベル一覧を開く
2. 新しい属性ラベルを作成（例：「シリーズ」）
3. 既存の属性ラベルを編集・削除

### UC-5: 類似画像の整理
1. システムが自動で類似・重複画像を検出
2. ユーザーが類似画像一覧を確認
3. 不要な重複を削除、または類似作品をまとめて閲覧

### UC-6: 作品の検索と閲覧
1. ユーザーが属性またはキーワードで検索
2. 検索結果がギャラリー形式で表示される
3. 気になる作品をクリックして詳細表示

### UC-7: シリーズ作品の管理
1. ユーザーがシリーズ用のコレクションを作成（例: 「○○漫画」）
2. シリーズの画像をコレクションに追加し、順番を並び替え
3. コレクションを開いてページ送りで連続閲覧

### UC-8: 今日のおすすめを見る
1. ユーザーがトップページまたは推薦画面を開く
2. 閲覧履歴と画像ベクトルに基づいた推薦画像が表示される
3. 気になる画像をクリックして詳細表示
4. 閲覧履歴が自動的に記録される

### UC-9: 閲覧統計を確認する
1. ユーザーが統計ダッシュボードを開く
2. 閲覧傾向（時間帯、曜日、よく見る属性など）が可視化される
3. 期間を指定して詳細な分析を確認

### UC-10: 動画のアップロードと閲覧
1. ユーザーが動画ファイル（MP4、WebM 等）をアップロード
2. システムが自動でサムネイルを生成し、メタデータを抽出
3. AI がキーフレームを解析して属性・説明を推薦
4. ギャラリーで画像と一緒に表示される
5. 詳細画面で動画を再生・操作できる

## 技術方針

### プラットフォーム戦略
- **Phase 1**: Web アプリ（現在）
- **Phase 2**: ネイティブアプリ化（Tauri / Electron 等）
  - デスクトップ（Windows / macOS / Linux）
  - モバイル（iOS / Android）は将来検討

### ストレージ選択
起動時またはセットアップ時にストレージモードを選択可能：

| モード | 説明 | ユースケース |
|--------|------|-------------|
| ローカル | 指定フォルダに画像・DB を保存 | オフライン利用、プライバシー重視 |
| クラウド | リモートサーバに接続 | 複数デバイス同期、バックアップ |

- ローカルモード: ファイルシステム直接アクセス、SQLite
- クラウドモード: REST API 経由でサーバと通信

### AI/ML
- **画像埋め込み**: CLIP モデルでベクトル化し、類似検索・属性推薦に活用
- **ローカル実行**: 外部 API 不要、プライバシー重視

### パフォーマンス
- 中規模（数万枚）でも快適に動作
- サムネイル生成による表示高速化
- ベクトル検索の効率化
