# 画像削除 (1-5)

## 目的・ゴール

不要な画像を削除できるようにする。詳細ページから画像を削除し、ストレージとDBから完全に削除する。

## 現状分析

### 既存実装
- **バックエンド**:
  - `deleteImageById(id)` - DBレコード削除（実装済み）
  - `deleteFile(path)` - ファイル削除（実装済み）
- **フロントエンド**:
  - `ImageDetailPage` - 画像詳細表示（削除ボタンなし）

### 不足している実装
- `DELETE /api/images/:id` エンドポイント
- 詳細ページに削除ボタン
- 削除確認ダイアログ
- 削除後のギャラリーへのリダイレクト

## 実装方針

### 1. バックエンド
- `DELETE /api/images/:id` エンドポイント追加
  - DBレコード削除
  - オリジナル画像ファイル削除
  - サムネイルファイル削除
  - トランザクション的に処理（DBレコード削除 → ファイル削除）

### 2. フロントエンド
- `packages/client/src/features/gallery/api.ts` に `deleteImage(id)` 追加
- `ImageDetailPage` に削除ボタン追加
- 削除確認ダイアログ（Mantine Modal）
- 削除成功後、ギャラリーにリダイレクト
- TanStack Query のキャッシュ無効化

## 完了条件

- [x] 詳細ページに削除ボタンが表示される
- [x] 削除ボタンを押すと確認ダイアログが表示される
- [x] 確認後、画像が削除される（DB + ファイル）
- [x] 削除後、ギャラリーにリダイレクトされる
- [x] 削除した画像がギャラリーに表示されない

## 作業ログ

### 2026-01-04

#### 実装完了

**バックエンド**:
- `DELETE /api/images/:id` エンドポイント追加（`packages/server/src/infra/http/routes/images.ts`）
  - DBレコード削除 → オリジナルファイル削除 → サムネイル削除

**フロントエンド**:
- `deleteImage(id)` API関数追加（`packages/client/src/features/gallery/api.ts`）
- 詳細ページに削除ボタン追加（赤いゴミ箱アイコン）
- 削除確認ダイアログ（Mantine Modal）
- 削除成功後、ギャラリーにリダイレクト + キャッシュ無効化

**動作確認**:
- Playwright でブラウザ確認完了
- 削除ボタン → 確認ダイアログ → 削除 → ギャラリーリダイレクト 全て正常動作
