# 非同期ジョブ管理機能（ジョブ完了時の通知と続きの操作）

## 目的・ゴール

非同期ジョブ（キャプション生成など）の管理機能を強化し、ユーザーがジョブの進捗・完了状態を把握しやすくする。

### 現状の課題

- ジョブを開始した画面から離れると、進捗が分からなくなる
- 複数のジョブを同時に実行した場合、全体の状況が把握しにくい
- ジョブ完了時に、ユーザーが結果を確認・適用する導線がない

### ゴール

1. **ジョブ一覧の可視化**: 実行中・完了済みのジョブを一覧で確認できる
2. **完了通知**: ジョブ完了時にトースト通知でユーザーに知らせる
3. **続きの操作**: 完了したジョブの結果を確認し、適用できる導線を提供

## 実装方針

### フロントエンド

1. **ジョブステータスコンテキスト**
   - グローバルな状態でアクティブなジョブを管理
   - 定期的にジョブ状況をポーリング

2. **ジョブ通知コンポーネント**
   - ヘッダーにジョブアイコン（実行中のジョブ数をバッジ表示）
   - クリックでジョブ一覧ドロワー/ポップオーバーを開く
   - ジョブ完了時にトースト通知

3. **ジョブ一覧UI**
   - 実行中のジョブ: 進捗バー表示
   - 完了したジョブ: 結果確認へのリンク
   - 失敗したジョブ: エラーメッセージ表示

### バックエンド

1. **ジョブ一覧API**
   - `GET /api/jobs` - ジョブ一覧取得（フィルタ: status, limit）
   - 既存の `GET /api/jobs/:id` を活用

## 変更対象ファイル

### フロントエンド（packages/web-client）

- `src/features/jobs/` - 新規 feature モジュール
  - `api.ts` - ジョブ API クライアント
  - `context.ts` - ジョブステータスコンテキスト
  - `components/JobStatusButton.tsx` - ヘッダーのジョブボタン
  - `components/JobListPopover.tsx` - ジョブ一覧ポップオーバー
  - `components/JobProgressItem.tsx` - 個別ジョブの進捗表示
- `src/shared/components/AppLayout.tsx` - ヘッダーにジョブボタン追加
- `src/App.tsx` - ジョブコンテキストプロバイダー追加

### バックエンド（packages/server）

- `src/infra/http/routes/jobs.ts` - ジョブ一覧 API 追加
- `src/app.ts` - ルート登録

## 完了条件

- [ ] ジョブ一覧 API が実装されている
- [ ] フロントエンドでジョブの進捗を一覧表示できる
- [ ] ジョブ完了時にトースト通知が表示される
- [ ] 完了したジョブから元の画像詳細ページに遷移できる
- [ ] 動作確認：キャプション生成を開始し、別ページに移動しても完了通知を受け取れる

## 作業ログ

（作業中に記録）
