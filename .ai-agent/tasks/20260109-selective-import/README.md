# タスク: 選択的インポート (3-2)

## 目的・ゴール

アーカイブプレビュー画面で必要な画像だけを選択して、ライブラリにインポートできるようにする。

## 提供価値

- アーカイブ内のすべての画像を一括インポートする必要がない
- 必要な画像だけを選んで効率的にライブラリに追加できる
- インポート結果を確認できる

## 実装方針

### バックエンド

1. **インポート API**
   - `POST /api/archives/:sessionId/import` - 選択した画像をインポート
   - リクエストボディ: `{ indices: number[] }` - インポートする画像のインデックス配列
   - レスポンス: インポート結果（成功数、失敗数、作成された画像 ID）

2. **処理フロー**
   - アーカイブセッションから指定インデックスの画像を展開
   - 既存の `uploadImage` ロジックを再利用してストレージに保存
   - サムネイル生成
   - データベースレコード作成

### フロントエンド

1. **画像選択 UI**
   - `ArchivePreviewGallery` にチェックボックスを追加
   - 選択状態の管理
   - 「全選択」「全解除」ボタン

2. **インポート UI**
   - 「インポート」ボタン（選択数を表示）
   - インポート中のローディング状態
   - インポート結果表示（成功/失敗数）

3. **UX 改善**
   - インポート後はギャラリーページへ遷移するか確認
   - セッションのクリーンアップ

## 完了条件

- [x] プレビュー画面で画像を選択できる
- [x] 選択した画像をインポートできる
- [x] インポート結果が表示される
- [x] 全選択/全解除ができる
- [x] テストが通る
- [x] ESLint エラーがない

## スコープ外

- インポート時の属性自動付与（AI 機能が必要）
- 重複チェック（将来のタスクで対応）
- バッチ処理の進捗表示（シンプルなローディングのみ）

## 作業ログ

### 2026-01-09

- タスク開始

### 2026-01-12

- 全機能の実装完了を確認
  - バックエンド: `POST /api/archives/:sessionId/import` API 実装済み
  - フロントエンド: 画像選択 UI、全選択/全解除、インポートボタン、結果表示
- テスト: 全 27 テスト通過
- ESLint: エラーなし
- タスク完了
