# タスク 6-2: 画像推薦

## 目的・ゴール

閲覧履歴と画像の埋め込みベクトルに基づいて、ユーザーの好みに合った画像を推薦する機能を実装する。

## 提供価値

- 閲覧傾向に基づいたおすすめ画像が表示される
- 新しい画像を発見しやすくなる
- ライブラリの活用度が向上する

## 実装方針

### 推薦アルゴリズム

1. **閲覧履歴ベースの推薦**
   - 最近閲覧した画像の埋め込みベクトルを取得
   - 滞在時間で重み付け（長く見た画像 = より興味がある）
   - 重み付き平均でユーザーの「好みベクトル」を算出

2. **類似画像検索**
   - 好みベクトルに近い画像を sqlite-vec で検索
   - 既に閲覧済みの画像は除外
   - 上位 N 件を推薦として返す

### API 設計

**GET /api/recommendations**
- クエリパラメータ:
  - `limit`: 取得件数（デフォルト: 10）
  - `historyDays`: 考慮する閲覧履歴の日数（デフォルト: 30）
- レスポンス:
  - 推薦画像リスト（ID、ファイル名、サムネイル、スコア）

### フロントエンド

1. **ホーム画面に推薦セクション追加**
   - 「おすすめ」セクションを表示
   - 横スクロールのサムネイルギャラリー

2. **推薦がない場合**
   - 閲覧履歴が少ない場合は「もっと画像を見てみましょう」などのメッセージ

## 完了条件

- [x] 推薦 API が実装されている
- [x] 閲覧履歴に基づいて推薦が生成される
- [x] ホーム画面に推薦セクションが表示される
- [x] 推薦がない場合の表示が適切

## 作業ログ

### 2026-01-17

- 推薦ユースケースを実装
  - `application/recommendation/generate-recommendations.ts`
  - 閲覧履歴から好みベクトルを算出（滞在時間で重み付け）
  - sqlite-vec で類似画像を検索（閲覧済みは除外）
  - スコアを距離から変換（1 / (1 + distance)）
- 推薦 API を実装
  - `GET /api/recommendations` エンドポイント
  - `limit`, `historyDays` パラメータ対応
  - 推薦がない場合の理由を返却
- フロントエンドを実装
  - `features/recommendations/` ディレクトリ作成
  - RecommendationSection コンポーネント
    - 横スクロールのサムネイルギャラリー
    - 推薦がない場合のメッセージ表示
  - HomePage に組み込み
- 動作確認完了
