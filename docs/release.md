# リリース手順

Picstash のリリースワークフローと手順について説明します。

## 概要

Picstash は GitHub Actions を使用した自動リリースワークフローを採用しています。リリースを実行すると、以下の処理が自動的に行われます:

1. バージョン番号の更新（すべての `package.json`）
2. Git タグの作成とプッシュ
3. 各プラットフォーム向けデスクトップアプリのビルド
4. GitHub Release の作成と成果物のアップロード

## リリース前チェックリスト

リリースを実行する前に、以下を確認してください:

- [ ] `main` ブランチに最新の変更がマージされている
- [ ] CI（テスト・リント）がすべてパスしている
- [ ] 重大なバグが残っていない
- [ ] 新機能や変更について、必要であれば README やドキュメントが更新されている

## バージョン番号の決め方

[セマンティックバージョニング](https://semver.org/lang/ja/) に従います:

```
MAJOR.MINOR.PATCH[-PRERELEASE]
```

| 種類 | 説明 | 例 |
|------|------|-----|
| MAJOR | 後方互換性のない変更 | `1.0.0` → `2.0.0` |
| MINOR | 後方互換性のある機能追加 | `1.0.0` → `1.1.0` |
| PATCH | バグ修正 | `1.0.0` → `1.0.1` |
| PRERELEASE | プレリリース版 | `1.0.0-alpha.1`, `1.0.0-beta.2` |

### バージョン番号の例

- `0.1.0` — 初回リリース（開発段階）
- `0.2.0` — 新機能追加
- `0.2.1` — バグ修正
- `1.0.0` — 正式リリース
- `1.1.0-beta.1` — 次のマイナーバージョンのベータ版

## リリースの実行

### 1. GitHub Actions ページを開く

[Actions タブ](../../actions) → 左サイドバーの「Release」を選択

### 2. ワークフローを実行

1. 「Run workflow」ボタンをクリック
2. ブランチを選択（通常は `main`）
3. バージョン番号を入力（例: `0.1.0`）
4. 「Run workflow」をクリック

### 3. ワークフローの完了を待つ

ワークフローは以下のジョブで構成されます:

1. **version-update** — バージョン更新とタグ作成（約1分）
2. **build** — 各プラットフォーム向けビルド（並列実行、約10-15分）
   - macOS (arm64, x64)
   - Windows (x64)
   - Linux (x64)
3. **release** — GitHub Release 作成（約1分）

## 成果物

リリースが完了すると、GitHub Release ページに以下の成果物がアップロードされます:

| プラットフォーム | ファイル形式 | 説明 |
|------------------|--------------|------|
| macOS | `.pkg` | インストーラーパッケージ（arm64 + x64 ユニバーサル） |
| Windows | `.exe` | NSIS インストーラー |
| Linux | `.AppImage` | ポータブル実行ファイル |
| Linux | `.deb` | Debian/Ubuntu パッケージ |

## トラブルシューティング

### タグが既に存在するエラー

```
Error: Tag v0.1.0 already exists
```

同じバージョン番号でリリースを再実行しようとした場合に発生します。新しいバージョン番号を指定してください。

### ビルドが失敗した場合

1. Actions のログを確認して原因を特定
2. 修正をコミット・プッシュ
3. タグを削除してリリースを再実行するか、新しいバージョン番号でリリース

タグを削除する場合:
```bash
# ローカルのタグを削除
git tag -d v0.1.0

# リモートのタグを削除
git push origin :refs/tags/v0.1.0

# GitHub Release も削除（Web UI または gh コマンド）
gh release delete v0.1.0 --yes
```

### macOS の署名エラー

現在、macOS 向けのパッケージは署名されていないため、インストール時に警告が表示されます。署名の設定については [コード署名手順](./code-signing.md) を参照してください。

## 関連ファイル

- `.github/workflows/release.yml` — リリースワークフロー定義
- `packages/desktop-app/electron-builder.json` — Electron Builder 設定
